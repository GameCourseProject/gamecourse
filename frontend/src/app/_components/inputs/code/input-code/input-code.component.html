<div class="form-control w-full {{classList}}">

  <div *ngIf="showAlert" class="justify-center flex flex-wrap mt-4">
    <div class="alert alert-warning shadow-md">
      <ng-icon name="tabler-alert-triangle" size="2rem"></ng-icon>
      <div><span>There are <strong>uncompleted lines</strong> of code below.
        Check the <strong>highlighted lines</strong> and <strong>change them</strong> to their desired behavior.</span></div>
    </div>
  </div>

  <!-- Label -->
  <label *ngIf="title" class="label cursor-pointer justify-start gap-2" [ngClass]="{'pl-0': helperText}">
    <app-simple-helper *ngIf="helperText" [text]="helperText" [position]="helperPosition"></app-simple-helper>
    <span class="label-text" [ngClass]="{'opacity-50': disabled}">{{title}} <span *ngIf="required" class="text-secondary">*</span></span>
  </label>

  <div *ngIf="showTabs" class="tabs tabs-boxed flex flex-wrap bg-base-content rounded-b-none">
    <ng-container *ngFor="let tab of tabs, let i = index">
      <a class="tab tab-sm text-base-200 {{tab.active ? 'tab-active' : ''}}" (click)="toggleTabs(i)">{{tab.name}}</a>
    </ng-container>
  </div>

  <div class="rounded-xl border-base-content {{size === 'lg' ? 'h-[35rem]' : 'h-64'}} border-2 overflow-y-auto
        {{getTheme() === 'light' && showTabs ? 'border-t-base-300' : ''}} {{showTabs ? 'rounded-t-none': ''}}"
       [style.background-color]="getTheme() === 'light' ? '#FFFFFF' : '#282C34'">

    <ng-container *ngFor="let tab of tabs, let i = index">
      <!-- Editor code tabs  -->
      <div *ngIf="tab.type === 'code'" class="cm {{!showTabs || tab.active ? '' : 'hidden'}}">
        <div [id]="getId(i, tab.name)"></div>
      </div>

      <!-- TODO: Editor reference manual tabs -->
      <div *ngIf="tab.type === 'manual' && tab.active">
        <div class="w-[calc(90%-0.5rem)] ml-1">

          <div class="w-full flex">
            <div class="w-[calc(50%-0.25rem)]">
              <div class="justify-center flex mb-1.5">
                <app-input-search
                  [id] = "'manual'"
                  [size]="'sm'"
                  [items] = "originalFunctions"
                  [placeholder]="'Search for function...'"
                  (valueChange)="filterFunctions($event)">
                </app-input-search>
              </div>
              <div class="bg-base-300 {{size === 'lg' ? 'h-[32.5rem]' : 'h-64'}} overflow-y-auto overflow-x-auto">
                <div *ngFor="let fx of functionsToShow">
                  <div class="badge badge-secondary mt-0.5 hover:cursor-pointer hover:badge-outline
                        {{isSelected(fx) ? 'badge-outline' : ''}}" (click)="selectFunction(fx)">
                    {{fx.keyword}}
                  </div>
                </div>

                <span *ngIf="functionsToShow.length === 0" class="text-base-content text-opacity-50 justify-center flex mt-40">
                Nothing found.
              </span>

              </div>
            </div>


            <div class="w-[calc(50%+0.25rem)] {{size === 'lg' ? 'h-[34rem]' : 'h-64'}} overflow-y-auto overflow-x-auto ml-2 mt-2">
              <span *ngIf="!selectedFunction" class="text-base-content text-opacity-50 justify-center flex mt-40">
                Choose a function to see information
              </span>

              <div *ngIf="selectedFunction">
                <div><strong>Namespace:</strong> <i>{{selectedFunction.name}}</i></div>
                <div><strong>Function: </strong><span class="text-secondary">{{selectedFunction.keyword}}</span></div>
                <div><strong>Description:</strong> {{selectedFunction.description}}</div>
                <div><strong>Args:</strong>
                  <ng-container *ngFor="let arg of selectedFunction.args, let i = index">
                    <span> {{arg.name}}{{selectedFunction.args.length - 1 !== i ? ',' : ''}}</span>
                  </ng-container>
                </div>
                <div><strong>Return type:</strong> {{selectedFunction.returnType.removeWord('->')}}</div>
              </div>
            </div>
          </div>

          <!--<app-input-search
            [id] = "'manual'"
            [items] = ""
            [placeholder]="'Search for functions...'"
            (valueChange)="filterFunctions($event)">
          </app-input-search>-->
        </div>
      </div>

      <!-- Editor output tabs -->
      <div *ngIf="tab.type === 'output' && tab.active">
        <!-- Warning message -->
        <div class="justify-center flex">
          <div *ngIf="isRunning(tab)" class="alert alert-warning shadow-lg rounded-lg w-[calc(90%-0.5rem)] mt-4">
            <div>
              <ng-icon [name]="'feather-alert-triangle'" size="1rem"></ng-icon>
              <span><strong>Code is running.</strong> Hold on! Results might take a while to appear (click refresh icon table to see if output is ready).</span>
            </div>
          </div>
        </div>

        <div *ngIf="!isRunning(tab) && isRunning(tab) !== null && tab.value !== null" class="justify-center flex">
          <textarea class="textarea textarea-bordered textarea-md w-[calc(80%-0.5rem)] h-full
          bg-transparent text-white border-base-300 mt-4">{{tab.value}}
          </textarea>
        </div>

        <div class="justify-center flex align-middle mt-4">
          <div class="tooltip tooltip-bottom w-[calc(80%-0.5rem)]" [attr.data-tip]="getTooltip(tab)">
            <button type="button" class="btn btn-success text-white w-full gap-2"
                    (click)="simulateOutput(tab)">
              <ng-icon *ngIf="!isRunning(tab)" name="feather-play-circle" size="1.2rem" class="text-white"></ng-icon>
              <app-spinner *ngIf="isRunning(tab)" [classList]="'ml-2'" [color]="'neutral-content'" [size]="'sm'"></app-spinner>
              Run
            </button>
          </div>

          <div *ngIf="isRunning(tab)" class="tooltip tooltip-bottom" [attr.data-tip]="'Refresh'">
            <button type="button" class="btn btn-ghost mt-1 gap-2 w-[calc(10%-0.5rem)] mb-1" (click)="refreshingOutput(tab)">
              <ng-icon name="feather-refresh-ccw" size="1.2rem" class="text-white"></ng-icon>
            </button>
          </div>
        </div>

      </div>
    </ng-container>

  </div>


</div>
