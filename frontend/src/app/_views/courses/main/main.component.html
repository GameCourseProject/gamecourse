<app-navbar></app-navbar>

<div id="wrapper">
  <!-- conteudo da pÃ¡gina -->
  <div id="content-wrapper" *ngIf="!loading">

    <!-- Sidebar -->
    <app-sidebar
      [filters]="user.isAdmin ? filters.admin : filters.nonAdmin"
      [orderBy]="user.isAdmin ? orderBy.admin : orderBy.nonAdmin"
      (onSearch)="searchList($event)"
      (onFilterChange)="filterList($event)"
      (onOrderChange)="orderList($event)">
    </app-sidebar>

    <!-- Main Content -->
    <div id="mainContent">
      <ng-container *ngIf="user.isAdmin" [ngTemplateOutlet]="adminTemplate"></ng-container>
      <ng-container *ngIf="!user.isAdmin" [ngTemplateOutlet]="nonAdminTemplate"></ng-container>
    </div>

  </div>

  <!-- Loader -->
  <div *ngIf="loading || loadingAction" id="page-loading">
    <img src="../../../../assets/loader/loader.gif" alt="loader">
  </div>
</div>

<!-- TODO: modals -->
<!-- TODO: boxes -->


<!-- Admin Template -->
<ng-template #adminTemplate>

  <!-- Action buttons TODO -->
  <div class="action-buttons ">
    <div class="icon add_icon" (click)="isNewCourseModalOpen = true; initColorPicker()"></div>
    <div class="icon import_icon" title="Import" value="#import-course" onclick="openModal(this)"></div>
    <div class="icon export_icon" title="Export all" ng-click="exportCourses()"></div>
  </div>

  <!-- Courses Table -->
  <div id="allCourses">
    <div class="data-table">

      <!-- Header -->
      <table id="courses-table">
        <thead>
        <tr>
          <th class="first-column"></th>
          <th class="name-column">Name</th>
          <th >Short</th>
          <th ># Students</th>
          <th >Year</th>
          <th class="check-column">Active</th>
          <th class="check-column">Visible</th>
          <th class="action-column"></th>
          <th class="action-column"></th>
          <th class="action-column"></th>
          <th class="action-column"></th>
        </tr>
        </thead>

        <!-- Body -->
        <tbody>
        <tr *ngFor="let course of filteredCourses">
          <td class="first-column">
            <div class="profile-icon">
              <div class="box" [ngStyle]="{'backgroundColor': course.color}"></div>
              <div class="frame" [ngStyle]="{'borderColor': course.color}" style="border: 1px solid"></div>
            </div>
          </td>
          <td class="name-column" [routerLink]=""><span>{{course.name}}</span></td>
          <td class="ng-binding">{{course.short}}</td>
          <td class="ng-binding">{{course.nrStudents}}</td>
          <td class="ng-binding">{{course.year}}</td>
          <td class="check-column">
            <label class="switch">
              <input type="checkbox" [checked]="course.isActive" (change)="toggleActive(course.id)">
              <span class="slider round"></span>
            </label>
          </td>
          <td class="check-column">
            <label class="switch">
              <input type="checkbox" [checked]="course.isVisible" (change)="toggleVisible(course.id)">
              <span ng-click="makeVisible(course.id)" class="slider round"></span>
            </label>
          </td>
          <td class="action-column">
            <div class="icon duplicate_icon" title="Duplicate" ng-click="duplicateCourse(course)"></div>
          </td>
          <td class="action-column">
            <div class="icon edit_icon" value="#edit-course" title="Edit" onclick="openModal(this)" ng-click="modifyCourse(course)"></div>
          </td>
          <td class="action-column">
            <div class="icon delete_icon" value="#delete-verification-1" title="Remove" onclick="openModal(this)"></div>
          </td>
          <td class="action-column">
            <div class="icon export_icon_no_outline" value="#export-verification-1" title="Export" onclick="openModal(this)"></div>
          </td>
        </tr>
        </tbody>
      </table>

    </div>
  </div>
</ng-template>


<!-- Non-Admin Template -->
<ng-template #nonAdminTemplate>

</ng-template>


<!-- New Course Modal -->
<ng-container *ngIf="isNewCourseModalOpen">
  <app-modal
    [isModalOpen]="isNewCourseModalOpen"
    [id]="'new-course'"
    [title]="'New Course:'"
    [templateRef]="newCourseModal"
    [positiveBtnText]="'Save'"
    [positiveBtnDisabled]="!isReadyToSubmit()"
    (positiveBtnClicked)="createCourse()"
    (closeBtnClicked)="isNewCourseModalOpen = false"
    [actionInProgress]="saving"
    [innerClickEvents]="false">
  </app-modal>
</ng-container>

<ng-template #newCourseModal>
  <div class="inputs">

    <!-- Name -->
    <div class="name full">
      <input type="text" class="form__input" id="name" placeholder="Name *" [(ngModel)]="newCourse.name" [required]="true">
      <label for="name" class="form__label">Name</label>
    </div>

    <div class="row_inputs">
      <div class="short_name half">
        <input type="text" class="form__input" id="short_name" placeholder="Short Name *" [(ngModel)]="newCourse.short" [required]="true">
        <label for="short_name" class="form__label">Short Name</label>
      </div>

      <div class="year half right">
        <input list="years" class="form__input" id="year" placeholder="Year *" [(ngModel)]="newCourse.year" [required]="true">
        <label for="year" class="form__label">Year</label>
        <datalist id="years">
          <option *ngFor="let year of yearsOptions" value="{{year}}"></option>
        </datalist>
      </div>

      <div class="color_picker half">
        <input type="text" class="form__input pickr" id="new_pickr" placeholder="Color *" [(ngModel)]="newCourse.color" role="button" aria-label="toggle color picker dialog">
        <label for="new_pickr" class="form__label">Color</label>
        <div id="color-sample">
          <div class="box" [ngStyle]="{'backgroundColor': newCourse.color || 'white'}"></div>
          <div class="frame" [ngStyle]="{'borderColor': newCourse.color || 'lightgray'}" style="border: 1px solid lightgray"></div>
        </div>
      </div>
    </div>

    <div class="row">
      <div class="on_off"><span>Active </span><label class="switch"><input id="active" type="checkbox" [(ngModel)]="newCourse.isActive"><span class="slider round"></span></label></div>
      <div class="on_off"><span>Visible </span><label class="switch"><input id="visible" type="checkbox" [(ngModel)]="newCourse.isVisible"><span class="slider round"></span></label></div>
    </div>
  </div>
</ng-template>


<!-- New Course Modal -->
