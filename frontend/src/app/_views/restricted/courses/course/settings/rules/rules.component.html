<div class="w-full relative">
  <!-- Header -->
  <app-header [title]="'Rules'" [icon]="'tabler-clipboard-list'"
              [loading]="loading.action"></app-header>

  <!-- Search -->
  <app-input-search
    [id] = "'sections-search'"
    [items] = "sections"
    [classList]="'lg:w-1/2 mx-auto'"
    (onSearch)="filteredSections = $event">
  </app-input-search>

  <!-- Top Actions
    //, dropdown: [
    //  {action: 'Create new section', icon:'tabler-new-section'},
    //  {action: 'Create new rule', icon: 'tabler-clipboard-list'}]
    // }]"
  -->
  <app-top-actions
    [leftActions]="[
      {action: Action.IMPORT, icon:'jam-download'},
      {action: Action.EXPORT, icon:'jam-upload'}
    ]"
    [rightActions]="[{action: 'Create new section', icon: 'feather-plus-circle', color: 'primary'}]"
    (btnClicked)="doAction($event)">
  </app-top-actions>

  <!-- Sections and Rules -->
  <div *ngFor="let section of sections">
    <app-header [subHeader]="true" [title]="section.name" [classList]="'mt-10'"></app-header>

    <div class="flex flex-wrap -mx-4">

      <ng-container *ngIf="!loading.page">
        <div *ngFor="let section of filterSections(section)">
          <!-- Actions for rules -->
          <app-top-actions
          [leftActions]="[
                {action: Action.IMPORT, icon:'jam-download'},
                {action: Action.EXPORT, icon:'jam-upload'}
              ]"
          [rightActions]="[{action: 'Create new rule', icon: 'feather-plus-circle', color: 'primary'}]"
          (btnClicked)="doAction($event)">
          </app-top-actions>

          <div *ngFor="let rule of rules"
               class="sm:w-1/2 xl:w-1/3 2xl:w-1/4 w-full p-4">
            <!-- Section Table -->
            <app-table
              [id] = "'rules'"
              [classList]="'mt-5'"
              [headers] = "headers"
              [data] = "data"
              [options] = "tableOptions"
              [loading] = "loading.table"
              (btnClicked)="doActionOnTable($event.type, $event.row, $event.col)"
              (valueChanged)="doActionOnTable('add', $event.row, $event.col, $event.value)">
            </app-table>
          </div>

        <span *ngIf="filterSections(section).length === 0" class="text-error px-4">No Sections</span>
        </div>
      </ng-container>

      <!-- Loader -->
      <app-loader [loading]="loading.page"></app-loader>

    </div>
  </div>
</div>


<!-- New / Edit section modal -->
<app-modal *ngIf="mode && sectionToManage"
  [id]="'manage-section'"
  [templateRef]="MANAGE_SECTION"
  [size]="'lg'"
  [header]="mode?.capitalize()"
  [actionInProgress] = "loading.action"
  (submitBtnClicked)="f.onSubmit(null); mode === 'add section' ? createSection() : editSection()">
</app-modal>

<ng-template #MANAGE_SECTION>
  <form #f="ngForm">
    <div class="flex flex-wrap">
      <div class="w-full sm:w-1/3 sm:pr-12">
        <app-input-text
          [id] = "'section-name'"
          [form] = "f"
          [(value)] = "sectionToManage.name"
          [placeholder]="'Section Name'"
          [topLabel]="'Name'"
          [pattern]="'(?!^\\d+$)^.+$'"
          [patternErrorMessage]="'Section name can\'t be composed of only numbers'"
          [required]="true"
          [maxLength]="60"
          [maxLengthErrorMessage]="'Section name is too long: maximum of 60 characters'">
        </app-input-text>
      </div>

      </div>
  </form>
</ng-template>

<!-- New / Edit rule modal -->
<app-modal *ngIf="mode && ruleToManage"
           [id]="'manage-rule'"
           [templateRef]="MANAGE_RULE"
           [size]="'lg'"
           [header]="mode?.capitalize()"
           [actionInProgress] = "loading.action"
           (submitBtnClicked)="f.onSubmit(null); mode === 'add rule' ? createRule() : editRule()">
</app-modal>


<ng-template #MANAGE_RULE>
  <form #f="ngForm">

    <div class="flex flex-wrap">

      <div class="w-full sm:w-1/3 sm:pr-12">
        <!-- Section -->
        <app-input-text
          [id] = "'rule-name'"
          [form] = "f"
          [(value)] = "ruleToManage.name"
          [placeholder]="'Rule Name'"
          [topLabel]="'Name'"
          [pattern]="'(?!^\\d+$)^.+$'"
          [patternErrorMessage]="'Rule name can\'t be composed of only numbers'"
          [required]="true"
          [maxLength]="60"
          [maxLengthErrorMessage]="'Rule name is too long: maximum of 60 characters'">
        </app-input-text>
      </div>

    </div>
  </form>
</ng-template>


<!-- Select Modal -->
